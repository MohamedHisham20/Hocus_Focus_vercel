{% extends "index0.html" %}
{% block body %}
<!-- the connection bet files -->
  <script type="text/javascript">
    // update each 4 seconds
    var intervalID = setInterval(update_values,3000);
        // fn to find the sound and play it
        function playSound() {
            var audio = document.getElementById("myAudio");
            audio.play();
        }
        // call to get the values from the app
      function update_values() {
            $.getJSON($SCRIPT_ROOT + '/_stuff',
                  //  store the data in result
          function(data) {
            $('#result').text(data.result);
            console.log(data);
              // to play the sound when yawn
            if (data.result === "Absent") {
            playSound();}
          });
        };
        //  stop the prediction text from viewing
        function stopTextColor() {
          clearInterval(intervalID);
        }
        // resets the interval again
        function startText() {
          intervalID = setInterval(update_values,3000);
        }
        
    </script>
<script type="text/javascript">
    navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
            const videoElement = document.getElementById('video');
            videoElement.srcObject = stream;
            videoElement.play();
        })
        .catch(function(err) {
            console.error("Error accessing camera: ", err);
        });

    function captureFrame() {
        const videoElement = document.getElementById('video');
        const canvasElement = document.getElementById('canvas');
        const context = canvasElement.getContext('2d');

        canvasElement.width = videoElement.videoWidth;
        canvasElement.height = videoElement.videoHeight;

        context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);

        return canvasElement.toDataURL('image/png');
    }

    function sendFrameToServer() {
        const frameData = captureFrame();

        $.ajax({
            type: 'POST',
            url: '/process_frame',
            data: {
                'frame': frameData
            },
            success: function(response) {
                $('#result').text(response.result);
            },
            error: function(error) {
                console.error('Error:', error);
            }
        });
    }

    setInterval(sendFrameToServer, 3000);
</script>
    <body onload="update_values();">

    <!-- Audio element -->
    <audio id="myAudio">
        <source src="{{ url_for('static', filename='audio/SHINZOU SASAGEYO SOUND EFFECT.mp3') }}" type="audio/mp3">
        Your browser does not support the audio element.
    </audio>
    <!-- navigation bar above -->
      <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="https://github.com/MohamedHisham20/Hocus_Focus" target="_blank">Hocus Focus</a>
        </div>
    </nav>
    <div class="camera">
        <!-- sets the place where the video will be viewed -->
        <img id="videoo" src="{{ url_for('process_frame') }}" width="100%"/>
    </div>
    <script>
      // to get the variable from the app
      document.getElementById("result").innerHTML;
      </script>
    <!-- Place your JavaScript here -->
        <video id="video" width="100%" autoplay></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <div class="right-container1">
<img class="flex-image" src="{{ url_for('static', filename='images/LOgo fateh.png') }}" alt="Logo">
    </div>
    <div class="right-container3">  
      <p id="stat">
        status
        <br>
        <span id="result">?</span>
      </div>
      <div class="right-container2">
        <button class="upload-label" onclick="startText();">Start!</button>
        <button class="upload-label-s" onclick="stopTextColor();">Stop</button>
      </div>
    </body>
{% endblock %}